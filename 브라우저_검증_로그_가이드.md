# 브라우저 검증용 로그 모니터링 가이드

## 🎯 브라우저 테스트 시 확인할 로그

### 1. 슬롯 게임 잭팟 재현 테스트

#### A. 백엔드 로그 (터미널)
```powershell
# 실시간 백엔드 로그 모니터링
docker logs cc_backend --tail 50 -f

# 슬롯 관련 로그만 필터링
docker logs cc_backend --tail 100 | findstr -i "slot\|spin\|jackpot"
```

**확인할 내용:**
- `🎰 슬롯게임` 로그 메시지
- `POST /api/games/slot/spin` API 호출
- `bet_amount`, `win_amount`, `is_jackpot` 값
- `reels` 결과 (7️⃣7️⃣7️⃣인지 확인)
- 잔액 업데이트 로그

#### B. 프론트엔드 콘솔 (F12 → Console)
```javascript
// 확인할 로그 메시지들
[unifiedApi] POST http://localhost:8000/api/games/slot/spin
[RealtimeSync] Received message: game_event
[RealtimeSync] Game event received: {subtype: "slot_spin", jackpot: true, win: 500}
[Toast] 🎰 JACKPOT! 잭팟을 터뜨렸습니다!
[GlobalSync] Balance updated: 749 → 1239
```

#### C. 네트워크 탭 (F12 → Network)
```
POST /api/games/slot/spin
- Request: {"bet_amount": 10}
- Response: {"success": true, "is_jackpot": true, "win_amount": 500, "reels": [["7️⃣","7️⃣","7️⃣"]], "balance": 1239}

GET /api/users/balance (자동 호출)
- Response: {"cyber_token_balance": 1239, "user_id": 1, "nickname": "어드민"}
```

### 2. 이벤트 시스템 전체 플로우 확인

#### A. 백엔드 로그 (터미널)
```powershell
# 이벤트 관련 로그 모니터링
docker logs cc_backend --tail 100 | findstr -i "event\|join\|claim"
```

**확인할 내용:**
- `GET /api/events/` (이벤트 목록)
- `POST /api/events/join` (이벤트 참여)
- `GET /api/events/my-events` (참여 상태 - 422 에러 확인)
- `POST /api/events/claim/{id}` (리워드 클레임)

#### B. 프론트엔드 콘솔
```javascript
[unifiedApi] GET http://localhost:8000/api/events/
[unifiedApi] POST http://localhost:8000/api/events/join
[RealtimeSync] Received message: event_progress
```

#### C. 네트워크 탭
```
GET /api/events/
- Response: [{"id": 1, "title": "Welcome Bonus", "active": true}]

POST /api/events/join
- Request: {"event_id": 1}
- Response: {"success": true, "message": "이벤트에 참여했습니다"}

GET /api/events/my-events (422 에러 예상)
- Status: 422 Unprocessable Entity
```

### 3. 페이지 이동시 토큰 유지 검증

#### A. 브라우저 개발자 도구 (F12 → Application/Storage)
```
Local Storage → http://localhost:3000
- accessToken: "eyJhbGciOiJIUzI1NiIs..."
- refreshToken: "eyJhbGciOiJIUzI1NiIs..."
- user: {"id": 1, "nickname": "어드민", ...}

Session Storage → http://localhost:3000
- (토큰 관련 데이터 확인)
```

#### B. 프론트엔드 콘솔 (페이지 이동 시)
```javascript
// 정상적인 경우
[Auth] Token found in localStorage
[Auth] User authenticated: {id: 1, nickname: "어드민"}

// 문제가 있는 경우
[Auth] Token not found or expired
[Auth] Redirecting to login
```

#### C. 네트워크 탭 (페이지 이동 시)
```
GET /api/auth/me
- Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
- Response: {"id": 1, "nickname": "어드민", "is_admin": true}

// 토큰 문제가 있는 경우
- Status: 401 Unauthorized
- Response: {"detail": "Could not validate credentials"}
```

## 🔧 검증 절차

### 1단계: 슬롯 게임 테스트
1. **준비**: 백엔드 로그 모니터링 시작
   ```powershell
   docker logs cc_backend --tail 50 -f
   ```

2. **브라우저 접속**: http://localhost:3000
3. **로그인**: admin/123456
4. **슬롯 게임 접속**: Games → Slot Machine
5. **F12 개발자 도구 열기** (Console + Network 탭)
6. **슬롯 스핀**: 여러 번 스핀해서 잭팟 확인
7. **로그 확인**: 위의 A, B, C 항목들 모두 확인

### 2단계: 이벤트 시스템 테스트
1. **이벤트 페이지 접속**: Events 메뉴
2. **이벤트 참여**: Welcome Bonus 이벤트 참여
3. **진행도 확인**: 이벤트 진행 상태 확인
4. **리워드 클레임**: 완료 후 리워드 수령 시도
5. **로그 확인**: 각 단계별 API 호출과 응답 확인

### 3단계: 토큰 유지 검증
1. **로그인 상태 확인**: F12 → Application → Local Storage
2. **페이지 이동**: 다른 메뉴들 클릭
3. **뒤로가기**: 브라우저 뒤로가기 버튼 클릭
4. **새로고침**: F5 새로고침
5. **토큰 상태 확인**: 각 단계에서 로그인 상태 유지 확인

## 🚨 문제 발생시 확인사항

### 슬롯 게임 문제
- **증상**: 잭팟이 났는데 보상이 없음
- **확인**: 백엔드 로그에서 `is_jackpot: true`, `win_amount: 500` 등 확인
- **의심**: 프론트엔드 UI 업데이트 또는 WebSocket 메시지 처리

### 이벤트 시스템 문제  
- **증상**: 참여는 되지만 진행도 확인 안됨
- **확인**: `GET /api/events/my-events` 422 에러 
- **해결**: 백엔드 API 수정 필요

### 토큰 관리 문제
- **증상**: 뒤로가기시 다른 유저 정보 표시
- **확인**: Local Storage의 토큰 값과 실제 API 응답 비교
- **의심**: 토큰 검증 로직 또는 세션 관리

## 📋 체크리스트

### ✅ 슬롯 게임
- [ ] 백엔드에서 잭팟 로그 확인
- [ ] 프론트엔드에서 WebSocket game_event 메시지 수신
- [ ] UI에 잭팟 애니메이션/메시지 표시
- [ ] 실제 잔액 증가 확인

### ✅ 이벤트 시스템
- [ ] 이벤트 목록 조회 성공
- [ ] 이벤트 참여 성공
- [ ] 진행도 확인 (또는 422 에러 확인)
- [ ] 리워드 클레임 테스트

### ✅ 토큰 관리
- [ ] 로그인 후 토큰 저장 확인
- [ ] 페이지 이동시 토큰 유지
- [ ] 뒤로가기시 세션 유지
- [ ] 새로고침시 자동 로그인

이 가이드를 따라 테스트하시면 현재 시스템의 모든 문제점을 정확히 파악할 수 있습니다!
